---
# vbr_install tasks file for veeamhub.veeam_vas
- name: Checking OS for pending reboots
  pending_reboot_check:
  register: precheck
- name: Is there an existing pending reboot?
  ansible.builtin.fail:
    msg: "This Windows server requires a reboot prior to beginning the Veeam Backup & Replication install. After rebooting this server, you can proceed with the installation."
  when:
    - precheck.pending_reboot | bool
- name: Including version-specific variables
  ansible.builtin.include_vars:
    file: "vars/vbr_v{{ version }}.yml"

# Does the legacy or new install process need to be used?
# All versions prior to 12.1 use the legacy process
- name: Including Legacy Install tasks
  ansible.builtin.include_tasks: legacy_vbr_install.yml
  when:
    - (version < 12) or (legacy | bool)

# Versions 12.1 and later use the new process
- name: Including New Install tasks
  ansible.builtin.include_tasks: new_vbr_install.yml
  when:
    - (version > 12) or (not legacy | bool)
